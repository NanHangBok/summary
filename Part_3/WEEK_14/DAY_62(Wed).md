# DAY 62

## 목차
- [RDS](#rds)
- [EC2](#ec2)
- [컨테이너 오케스트레이션](#컨테이너-오케스트레이션)

---

## RDS
- AWS에서 제공하는 클라우드 환경에서 제공되는 관리형 관계형 데이터베이스 서비스
- 데이터베이스 엔진을 선택할 수 있으며, 백업, 보안, 패치, 모니터링 등의 운영 작업이 자동화
- 특징
  - 자동 설치 제공
  - 보안 패치 자동 업데이트
  - 자동 백업 지원
  - 모니터링 기본 제공
  - 클릭 몇 번으로 확장 가능
- SQL 튜닝, 인덱스 설계, 쿼리 최적화는 개발자가 직접 해야 함.

#### PostgreSQL RDS 특징
- 오픈소스, ACID 보장, JSON 타입 지원, 풍부한 함수와 확장성.
- 장점
  - JSON 지원
  - 확장 기능
  - 표준 SQL 호환성
  - 강력한 트랜잭션 처리
 
## EC2
- AWS에서 제공하는 가상 서버 서비스
- 클라이언트 환경에서 애플리케이션을 실행할 수 있는 기본 단위
- 특징
  - 필요할 때 즉시 생성 가능
  - 사용한 만큼만 비용 지불
  - 다양한 크기(CPU/메모리/스토리지 조합) 선택 가능
  - 손쉽게 확장/축소 가능 (Auto Scaling 지원)
- 다양한 목적에 맞게 여러 인스턴스 패밀리 제공

- AMI
  - EC2 인스턴스를 시작할 때 기반이 되는 운영체제 이미지 + 소프트웨어 설정 묶음
  - 종류
    - AWS 제공 기본 AMI
    - Marketplace에서 제공되는 AMI
    - 사용자가 직접 커스터마이징한 AMI
- 인스턴스를 생성한다는 것은 AMI를 토대로 운영체제, CPU, RAM 혹은 런타임 등이 구성된 컴퓨터를 빌리는 것

- 보안 그룹
  - EC2 인스턴스에 대한 방화벽 규칙 설정
 
- 키 페어
  - EC2 인스턴스에 접속할 때 사용하는 인증 수단(SSH 비밀키/공개 키 쌍)
  - 인스턴스를 시작할 때 키 페어를 등록하고, 접속 시 개인 키 파일(.pem)을 사용

- VPC
  - AWS에서 제공하는 가상의 네트워크
  - 하나의 AWS 계정에 여러 개의 VPC를 만들 수 있으며, 보통 리전당 하나의 기본 VPC가 존재
- 서브넷
  - VPC를 더 작은 네트워크 단위로 나눈 것
  - 가용 영역에 종속
  - 보통 퍼블릭 서브넷과 프라이빗 서브넷으로 나눔.
 
## 컨테이너 오케스트레이션
- 수십~수백 개의 컨테이너를 도잇에 실행하고 관리해야 함.
- 이럴 때 필요한 것이 바로 컨테이너 오케스트레이션
  - 컨테이너 배치
  - 컨테이너 상태 모니터링
  - 확장/축소
  - 네트워크 연결 및 로드밸런싱
- 이러한 기능을 자동으로 수행하는 도구가 오케스트레이터

#### ECS
- AWS에서 제공하는 완전관리형 컨테이너 오케스트레이션 서비스
  - Cluster -> TaskDefinition -> Task -> Service
- Cluster : 컨테이너를 실행할 수 있는 "운영 단지"
  - 컨테이너가 돌아가는 논리적 실행 환경
  - 클러스터 안에서 작업(Service/Task)을 배치
  - EC2, Fargate
  - VPC, 서브넷, 보안그룹은 Task(Fargate/awsvpc) 실행 시점에서 지정
  - 용량 제공자 전략으로 서비스가 EC2 스팟/온디맨드를 어떤 비율로 쓸지 정할 수 있다.
  - 클러스터 CloudWatch 지표를 보고 스케일 전략을 조정
- Task Definition : 컨테이너를 어떻게 띄울지에 대한 "설계도"
  - 컨테이너 이미지, CPU/메모리, 포트, 환경 변수, 로그, 볼륨 등 실행 방법을 기술한 템플릿
  - 리소스 조합 주의(fargate)
    - CPU/메모리 값은 허용 조합만 가능. 값이 안 맞으면 런칭 실패
- Task : 설계도를 바탕으로 실제로 띄워진 "입주 세대(컨테이너 집합)"
  - Task Definition을 바탕으로 실제 실행 중인 인스턴스
  - 하나 이상의 컨테이너를 포함
  - 상태 흐름
    - Provisioning
    - pending
    - running
    - stopped
  - 각 Task에 개별 ENI/IP가 붙는다.
  - 보안그룹/서브넷은 서비스나 RunTask 시에 지정
  - CloudWatch Logs에 컨테이너 stdout/stdeer 수집, CloudWatch Metrics/Synthetics로 헬스 체크
- Service : 세대 수 유지, 교체 공사(배포), 공동시설(ALB) 연결을 담당하는 "관리사무소"
  - 원하는 개수의 Task를 지속적으로 유지하고, 배포/롤링 교체, 로드밸런서 연결, 오토스케일링 담당
  - 롤링 배포 기본. 동시 교체 폭 제어
  - 배포 회로 차단기 옵션을 켜면, 헬스 실패 시 자동 롤백
  - 대상 그룹 헬스 체크 경로를 컨테이너 포트와 일치시켜야 로드밸런서 연동
  - Target Tracking 또는 Step Scaling 사용. 스케일 인 보호를 켜면 급격한 축소 방지
  - 스케줄링 전략
    - REPLICA(기본) 원하는 수만큼 Task를 곳곳에 퍼뜨림
    - DAEMON(EC2 한정) : 각 EC2 인스턴스마다 1개씩 Task 실행(로그 수집 데몬 등)
   
#### EC2 Launch Type
- 직접 서버를 관리하는 방식
- 사용자가 EC2 인스턴스를 클러스터에 등록하고, 그 위에 컨테이너(Task)가 배치됨
- 장점
  - 세밀한 제어 가능
  - 스팟 인스턴스를 활용해 비용 절감 가능
  - 특정 하드웨어 리소스 활용 가능
- 단점
  - EC2 인스턴의 패치, 보안 업데이트, 스케일링을 직접 관리해야 함
  - 예상치 못한 다운타임이나 인스턴스 종료 이벤트에 대응 필요
 
#### Fargate Launch Type
- 서버리스 컨테이너 실행 방식
- EC2 인스턴스를 따로 띄우지 않고, Task 실행 요청만 하면 AWS가 알아서 실행 환경을 준비
- 장점
  - 서버 관리 필요 없음 -> 운영 단순화
  - 필요할 때만 과금되므로 단기,실험적 프로젝트에 유리
  - 자동 확장과 내결함성 보장
- 단점
  - 단위 리소스 비용이 EC2보다 높음
  - 세밀한 하드웨어 제어가 불가능
