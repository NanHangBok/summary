# DAY 61

## 목차
- [이미지 빌드](#이미지-빌드)
- [DockerHub 배포 및 실행](#dockerhub-배포-및-실행)
- [Docker Compose](#docker-compose)
- [AWS](#aws)

---

## 이미지 빌드
- buildx build
  - build를 확장한 명령어로 멀티 아키텍처 빌드와 고급 빌드 옵션을 제공.
    ```
    docker buildx build \
    -- platform linux/amd64, linux/arm64 \ # 멀티 플랫폼(쉼표로 구분)
    -t usernane/my-app:1.0.0 \ # 이미지 이름과 태그 지정
    .
    ```
  - `--push` : 빌드 완료 후 자동으로 레지스트리에 푸시
  - `--load` : 빌드한 이미지를 로컬 Docker 엔진에 로드
 
- 이미지 태깅
  - 이미지 버전과 용도를 구분하는 식별자
  - 같은 이미지에 여러 태그를 지정할 수 있어 개발/운영 환경을 쉽게 나눌 수 있음
  - `docker tag my-app:latest username/my-app:1.0.0`
  - latest는 가급적 개발/테스트 용도로만 사용
 
## DockerHub 배포 및 실행
- `docker push username/my-app:1.0.0`
 
- 멀티스테이지 빌드
  - Dockerfile을 여러 개의 단계로 나눠서 빌드하는 방식
  - 목적
    - 빌드 툴 제거
    - 실행 환경 경량화
    - 캐시 재사용
- 컨테이너 실행 시 외부에서 환경변수 주입 가능
```
docker run -d -p 8080:8080 \
  -e SPRING_DATASOURCE_URL=jdbc:postgresql://host.docker.internal:5432/discodeit \
  -e SPRING_DATASOURCE_USERNAME=discodeit_user \
  -e SPRING_DATASOURCE_PASSWORD=discodeit1234 \
  my-spring-app:1.0
```
```
docker run --env-file .env my-spring-app:1.0
# .env 파일 활용 가능
```

- 헬스체크 설정
  - ```
    HEALTHCHECK --interval=30s --timeout=5s --retries=3 \\
    CMD curl -f <http://localhost:8080/actuator/health> || exit 1
    ```
  - interval : 체크 주기
  - timeout : 응답 대기 시간
  - -retries : 실패 허용 횟수
 
## Docker Compose
- 실제 개발/운영 환경은 보통 여러 컨테이너가 함께 동작.
- 컨테이너를 여러 개 순서대로 실행/중지 하는 작업이 번거로움.
- 포트/볼륨/네트워크/환경변수 등 긴 명령어 옵션을 매번 기억/복붙해야 함.
- 팀원이 바뀌면 환경 셋업이 달라져 재현성이 떨어짐
- docker run 조합은 선언형 문서가 아니라서 버전 관리/코드 리뷰가 어려움

- Compose
  - 선언형 설정 파일(docker-compose.yml) 하나로 전체 스택을 정의
  - docker compose up -d 한 줄로 멀티 컨테이너를 실행/중지/정리
  - 네트워크/볼륨/환경변수/헬스체크 등 운영 설정을 표준화하여 재현성 확보
  - 서비스 간 DNS 서비스명으로 통신(별도 IP 관리 불필요)

- docker-compose.yml 설정 후 실행
  - `docker compose up` , `docker compose down`

## AWS
- 아마존에서 제공하는 클라우드 컴퓨팅 서비스 플랫폼
- 필요할 때만 빌려 쓸 수 있는 서비스
- 기존에 서버 하드웨어 방식은 시간과 비용이 많이 들고, 확장이 어려움
- 클라우드 컴퓨팅 이점
  - 비용 절감
  - 확장성
  - 유연성
  - 글로벌 인프라
  - 유지보수 부담 감소

#### 온디멘드
- 필요할 때마다 즉시 사용할 수 있도록 제공되는 IT 서비스 방식.
- 클라우드 컴퓨팅 환경에서 주로 사용되며, 사용한 만큼 비용 지불
- 특징
  - 유연성 : 필요 시 자원 추가,제거 가능
  - 비용 효율성 : 초기 투자 비용이 거의 없음
  - 빠른 배포 : 신규 서비스/자원 즉시 배포 가능
  - 접근성 : 인터넷만 있으면 어디서든 접속 가능
  - 자동화 : 다양한 자동화 지원
- 장점
  - 초기 비용이 낮음
  - 확장성과 유연성이 뛰어남
  - 유지보수 부담이 낮음
- 단점
  - 인터넷 연결 필수
  - 장기 사용 시 비용 증가 가능성
  - 데이터 보안 문제 가능
 
#### 온프레미스
- 조직 내부에 물리 서버와 IT 인프라를 직접 설치,관리하는 방식
- 모든 하드웨어와 소프트웨어가 조직 데이터센터에 위치
- 특징
  - 보안성 : 내부 시스템 관리로 높은 보안 가능
  - 제어권 : 모든 장비와 소프트웨어를 직접 제어
  - 성능 : 네트워크 상태에 영향 적음
  - 맞춤화 : 시스템을 필요에 맞게 커스터마이징 가능
- 장점
  - 높은 보안성
  - 완전한 제어권
  - 인터넷 연결 없이도 사용 가능
- 단점
  - 초기 투자 비용이 큼
  - 유지보수 인력과 비용 부담
  - 확장성 낮음
 
#### IAM
- AWS에서 사용자와 서비스의 신원을 관리하고, 리소스에 대한 접근 권한을 제어하는 핵심 보안 서비스
- 구성요소
  - 사용자, 그룹, 역할, 정책
- 주요 특징
  - 글로벌 서비스
  - 세밀한 권한 제어
  - 정책 상속
  - 보안강화 기능
- MFA (Multi-Factor Authentication)
  - 두 가지 이상의 인증 요소를 요구해 계정 탈취 위험을 크게 줄이는 방법
 
#### 클라우드 스토리지
- 인터넷을 통해 접근 가능한 데이터 저장소
- 인터넷이 연결된 환경이면 언제 어디서든 접근 가능
- 장점
  - 접근성 : 장소 제약 없이 데이터 접근 가능
  - 다양한 디바이스 호환 : PC, 태블릿, 스마트폰 등
  - 백업 및 복구 용이성
 
- S3
  - AWS에서 제공하는 객체 스토리지 서비스
  - 장점
    - 높은 확장성
      - 무한대 저장 가능.
      - 사용량 증가에 따라 자동 확장
    - 강력한 내구성
      - 데이터 손실 가능성이 극도로 낮음
    - 높은 가용성
    - 다양한 스토리지 클래스
    - 정적 웹 사이트 호스팅
   
  - 핵심 개념
    - 버킷
      - 최상위 디렉토리 역할
      - 리전별로 고유한 이름 필요 (버킷의 이름은 각 리전에서 고유해야 함. 개인이 아니라 전체)
      - 무제한 객체 저장 가능
      - 접근 권한은 버킷 정책으로 제어
    - 객체
      - 버킷에 저장되는 파일 단위 데이터
      - 구성요소
        - 파일(데이터) : 최대 5TB
        - 메타데이터 : 생성일, 크기, 타입정보
        - 키(key) : 고유 식별자
